# You can override the included template(s) by including variable overrides
# SAST customization: https://docs.gitlab.com/ee/user/application_security/sast/#customizing-the-sast-settings
# Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
# Dependency Scanning customization: https://docs.gitlab.com/ee/user/application_security/dependency_scanning/#customizing-the-dependency-scanning-settings
# Container Scanning customization: https://docs.gitlab.com/ee/user/application_security/container_scanning/#customizing-the-container-scanning-settings
# Note that environment variables can be set in several places
# See https://docs.gitlab.com/ee/ci/variables/#cicd-variable-precedence
default:
  image: node:20.11.0-alpine3.19
  before_script:
  - uname -a
  - node --version || true
  - npm --version || true
setup:
  stage: build
  script:
  - npm install -g bower
  - bower --version
  - apk add --no-cache git
  - bower install --allow-root
  - npm ci --cache .npm --prefer-offline
  cache:
    key:
      files:
      - package-lock.json
    paths:
    - ".npm/"
  artifacts:
    name: "$CI_COMMIT_REF_SLUG"
    expire_in: 1 week
    paths:
    - node_modules
    - bower_components
deploy_development:
  stage: deploy
  environment: development
  needs:
  - setup
  script:
  - apk add --no-cache lftp
  - lftp --version
  - echo "listing working directory..."
  - ls -la
  - echo "transferring files and listing remote directory..."
  - "lftp -e \"\n  set cmd:fail-exit yes; \n  open $FTP_HOST; \n  user $FTP_USER $FTP_PASSWORD;
    \n  mirror --exclude-glob='.*' --exclude-glob='.git/*' --include='.htaccess' --exclude='Dockerfile'
    --exclude='docker-compose.yml' --exclude='bower.json' --exclude='package.json'
    --exclude='package-lock.json' --exclude='renovate.json5' --exclude='README.md'
    --exclude='config.json.sample' --exclude='config.json' --reverse --delete --parallel=10
    --verbose ./ ./registration/${CI_ENVIRONMENT_NAME}/;\n  ls -la registration/${CI_ENVIRONMENT_NAME};
    \n  bye\n\"\n"
  rules:
  - if: "$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH"
include:
- template: Security/Secret-Detection.gitlab-ci.yml
